---
title: n8n v2.0 断裂更改
description: 打破版本2.0 中的更改
contentType: 参考
---

# n8n v2.0 断裂更改

n8n v2.0 将很快发布。 本文件突出了重要的突破性变化和你为筹备过渡应采取的行动。 这些更新提高了安全性，简化了配置，并删除了旧功能。

n8n 2.0 的发行使n8n继续致力于提供一个安全、可靠和便于生产的自动化平台。 这个主要版本包括重要的加强安全措施和清理废弃的功能。

## 行为变化

### 当包含一个等待节点时，返回预期的子工作流数据

之前, 当一个工作流(家长) 调用一个包含等待节点的子工作流(子) 父工作流不正确地接收了从子工作流到等候节点的输入项。

在 v2 中，父工作流现在接收子工作流结束后的输出数据。

**迁移路径：** 审查任何调用子工作流并期望收到输入到等候节点的工作流。 更新这些工作流以处理新的行为，即父工作流从子工作流结束时接收输出。

### 移除退役服务的节点

以下节点已被删除，因为它们连接到的外部服务不再可用：

- Sponge 节点
- crowd.dev 节点
- Kitemaker node

**迁移路径：** 如果您的工作流使用这些节点，更新或删除这些工作流以避免错误。

## 安全

### 默认情况下，从代码节点阻止环境变量访问

为了提高安全性，n8n默认会阻止访问代码节点的环境变量。 `N8N_BLOCK_ENV_ACESS_IN_NODE` 的默认值现在设置为 `true`。

**迁移路径：** 如果您的工作流需要访问代码节点中的环境变量，请在您的环境配置中设置`N8N_BLOCK_ENV_ACCESS_IN_NODE=false` 。 对于敏感数据，使用凭据或其他安全方法而不是环境变量。

### 强制启用设置文件权限

n8n 需要严格的文件权限才能提高安全性。 默认情况下，配置文件必须使用 `0600` 权限，这意味着只有文件所有者可以读写。 这种方法类似于SSH如何保护私钥。

**迁移路径：** 在v2.0之前测试此行为，设置`N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true`。 如果您的环境不支持文件权限(例如在Windows上)，请设置 `N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=false` 来禁用此要求。

### 默认启用任务运行器

n8n 将默认启用[任务运行器](/hosting/configuration/task-runners.md)来改善安全和隔离。 所有代码节点执行将运行任务运行器。

**迁移路径：** 升级到 v2.0 之前，设置 N8N_RUNNERS_ENABLED=true 测试此行为。 请确保您的基础设施符合运行任务的要求。 对于额外的安全性，请考虑使用 [外部模式] (/hosting/configuration/task-runners.md#external-mode)。

### 从 `n8nio/n8n` 停靠图像中移除任务运行器

从 v2.0开始，主`n8nio/n8n` 停靠器将不再包括外部模式下的任务。 您必须使用单独的 `n8nio/runners` Docker 图像来运行外部模式下的任务运行器。

**迁移路径:** 如果你使用外部模式运行停靠在停靠码头的任务, 更新你的设置以使用 `n8nio/runners` 图像而不是 `n8nio/n8n` 。

### 删除基于 Pyodide 的 Python 代码节点

n8n 将移除基于 Pydodie 的 Python 代码节点，并将其替换为 [基于任务的运行](/hosting/configuration/task-runners.md)，它使用原生的 Python 来提高安全性能和性能。 从 v2.0 开始，您只能在[外部模式](/hosting/configuration/task-runners.md#external-mode)中使用任务运行器的 Python 代码节点。

原生的 Python 代码节点不支持内置变量，如`_input` 或点访问符，这些变量可以在 Pyodide 版本中获得。 欲了解详情，请查看[代码节点文档](/integrations/builtin/core-nodes/n8n-nodes-base.code/index.md#python-native-beta)。

**迁移路径：** 要继续在代码节点中使用 Python，请在外部模式中设置任务运行器，并审查您现有的 Python 代码节点兼容性。

### 默认禁用执行命令和 LocalFileTrigger 节点

n8n 将默认禁用 rhe `ExecuteCommand` 和 `LocalFileTrigger` 节点，因为它们构成安全风险。 这些节点允许用户运行任意命令和访问文件系统。

**迁移路径：** 如果您需要使用这些节点， 通过更新 `NODE_EXCLUDE` 环境变量，从您的 n8n 配置中移除这些已禁用节点列表。 例如，设置 `NODES_EXCLUDE="[]` 以启用所有节点，或仅移除您需要的特定节点。

### 默认需要对 OAuth 回调URL进行身份验证

n8n 默认情况下OAuth 回调端点需要身份验证。 `N8N_SKIP_AUTH_ON_OOAUTH_CALLBACK` 的默认值将从 `true` (无需认证) 更改为 `false` (需要认证)。

**迁移路径：** 在升级到 v2.0 之前，设置 `N8N_SKIP_AUTH_ON_OAUTH_CALLBACK=false` 并测试您的 OAuth 集成以确保它们能够使用身份验证。

### 设置N8N_RESTRICT_FILE_ACCSESS_TO 的默认值

n8n 将设置一个 `N8N_RESTRICT_FILE_ACCSESS_TO` 的默认值来控制文件操作的位置。 这影响了 "ReadWriteFile" 和 "ReadBinaryFiles" 节点。 默认情况下，这些节点只能访问在 n8n 主文件夹内的 `./data` 目录中的文件。

**迁移路径：** 审查您使用文件节点的工作流，并确保他们只访问允许目录中的文件。 如果您需要允许访问其他目录，请将`N8N_RESTTRICT_FILE_ACCESS_TO`环境变量设置为您想要的路径。

### 将N8N_GIT_NODE_DISABLE_BARE_REPOS 的默认值更改为true

默认情况下，Git节点将基于安全原因阻止bare仓库。 `N8N_GIT_NODE_DISABLE_BARE_REPOS` 的默认值设置为`true`, 这意味着除非您更改此设置，否则将禁用bare仓库。

**迁移路径：** 如果您的工作流需要使用bare 仓库，请在您的环境配置中设置`N8N_GIT_NODE_DISABLE_BARE_REPOS=false` 以启用它们。

## 数据

### 拖放MySQL/MariaDB 支持

n8n 将不再支持 MySQL 和 MariaDB 作为存储后端。 这种支持在 v1.0 中被废弃。 如需最佳兼容性和长期支持，请使用 PostgreSQL

**迁移路径：** 在升级到 v2.0之前，使用数据库迁移工具将您的数据从 MySQL 或 MariaDB 移动到 PostgreSQL 或 SQLite。

### 移除 SQLite 旧版驱动程序

由于可靠性问题，n8n 将删除遗留的 SQLite 驱动程序。 汇集驱动程序将成为默认值，并且仅限 SQLite 驱动程序。 集合驱动程序使用 WAL模式、单个写入连接和一组读连接。 我们的基准表明，它可以更快地达到10倍。

**迁移路径：** `sqlite-pooled`驱动程序将自动成为默认。 您现在可以通过设置 `DB_SQLITE_POOL_SIZE` 到大于`0`的值来启用池。 默认池大小将设置为 \`2'。

### 移除内存二进制数据模式

n8n 将移除`N8N_DEFAULT_BINARY_DATA_MODE`的默认模式，它在内存中存储执行二进制数据。 文件系统模式将成为更好的性能和稳定性的唯一选项。 `N8N_AVAILABLE_BINARY_DATA_MODES` 设置也将被删除，所以模式现在只能由`N8N_DEFAULT_BINARY_DATA_MODE`决定。

**迁移路径：** 文件系统模式将被自动使用。 请确保您的 n8n 实例有足够的磁盘空间来存储二进制数据。 For details, see the [binary data configuration](/hosting/configuration/environment-variables/binary-data.md).

## 配置与环境

### 升级 Dotenv

n8n 使用 `dotenv` 库从`.env` 文件中加载环境配置。 库将从 8.6.0 版本升级到最新版本，这可能会更改 `.env` 文件的解析方式。 关键的突破性变化包括：

- Backtick 支持 ([#615](https://github.com/motdotla/dotenv/pull/615)：如果您的值包含背景，将它们换成单引号或双引号。
- 多行支持：您现在可以使用多行值。
- `#` 标志着评论的开头：以# 开头的行被当作评论。

**迁移路径：** 审阅[dotenv changelog](https://github.com/motdotla/dotenv/blob/master/CHANGELOG.md)，并更新您的 `.env` 文件以确保与新版本兼容。

### 删除 n8n --tunnel 选项

`n8n --tunnel `command-line 选项将在 v2.0 中删除。

**迁移路径:** 如果你目前使用 `--tunnel` 选项来开发或测试. 切换到替代隧道解决方案，例如ngrok、localtunnel 或 Cloudflare Tunnel。 更新您的工作流和文档以反映此更改。

### 移除 QUEUE_WORKER_MAX_STALLED_COUNT

“QUEUE_WORKER_MAX_STALLED_COUNT”环境变量和停工的Bull重试机制将被删除，因为它们常常造成混乱，无法可靠地工作。

**迁移路径:** 从您的配置中删除此环境变量。 升级后，n8n将不再自动重试已停顿的任务。 如果您需要处理已停顿的作业，请考虑实现您自己的重试逻辑或监测。

## CLI & 工作流

### 移除CLI命令操作以激活所有工作流

CLI 命令`update:workflow --all --active=true`, 它一次激活所有工作流, 将被删除, 以防止在生产环境中意外激活工作流。

**迁移路径：** 使用 API 或 UI 在一次或一次控制的小批量中激活一个工作流。 这有助于您避免意外的后果，更好地控制工作流激活。

## 报告问题

如果您在升级到 n8n 2.0时遇到任何问题，请访问社区 [forum](https://community.n8n.io/) 以获得帮助和支持。
